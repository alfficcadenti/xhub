import React, {useEffect, useState} from 'react';
import moment from 'moment';
import 'moment-timezone';
import TravelerMetricsWidget from '../../components/TravelerMetricsWidget';
import LoadingContainer from '../../components/LoadingContainer';
import {DatetimeRangePicker} from '../../components/DatetimeRangePicker';
import {useFetchProductMapping, useQueryParamChange, useSelectedBrand, useZoomAndSynced} from '../hooks';
import {
    EG_BRAND,
    EGENCIA_BRAND,
    EXPEDIA_PARTNER_SERVICES_BRAND
} from '../../constants';
import {
    checkResponse,
    adjustInputValue,
    getBrand,
    getListOfUniqueProperties,
    getUniqueByProperty,
    addSuggestionType,
    getAnnotationsFilter,
    filterNewSelectedItems
} from '../utils';
import './styles.less';
import {adjustTicketProperties} from '../TicketTrends/incidentsHelper';
import UniversalSearch from '../../components/UniversalSearch';
import {Checkbox} from '@homeaway/react-form-components';


const TIMEZONE_OFFSET = (new Date()).getTimezoneOffset();
const TIMEZONE_ABBR = moment.tz.zone(moment.tz.guess()).abbr(TIMEZONE_OFFSET);
const PAGE_VIEWS_DATE_FORMAT = 'YYYY-MM-DD HH:mm';


const FunnelView = ({selectedBrands, onBrandChange, prevSelectedBrand}) => {
    const initialStart = moment().subtract(6, 'hours').startOf('minute');
    const initialEnd = moment().endOf('minute');
    const initialTimeRange = 'Last 6 hours';

    const [widgets, setWidgets] = useState([]);
    const [isLoading, setIsLoading] = useState(true);
    const [error, setError] = useState('');
    const [pendingStart, setPendingStart] = useState(initialStart);
    const [pendingEnd, setPendingEnd] = useState(initialEnd);
    const [start, setStart] = useState(initialStart);
    const [end, setEnd] = useState(initialEnd);
    const [isDirtyForm, setIsDirtyForm] = useState(false);
    const [currentTimeRange, setCurrentTimeRange] = useState(initialTimeRange);
    const [pendingTimeRange, setPendingTimeRange] = useState(initialTimeRange);
    const [isFormDisabled, setIsFormDisabled] = useState(false);

    // annotations state
    const [enableAnnotations, setEnableAnnotations] = useState(false);
    const [selectedProducts, setSelectedProducts] = useState([]);
    const [selectedApplications, setSelectedApplications] = useState([]);
    const [selectedServiceTiers, setSelectedServiceTiers] = useState([]);
    const [selectedStatuses, setSelectedStatuses] = useState([]);
    const [selectedPriorities, setSelectedPriorities] = useState([]);

    const [deploymentAnnotations, setDeploymentAnnotations] = useState([]);
    const [incidentAnnotations, setIncidentAnnotations] = useState([]);
    const [filteredAnnotations, setFilteredAnnotations] = useState([]);

    const [deploymentCategory, setDeploymentCategory] = useState(true);
    const [incidentCategory, setIncidentCategory] = useState(true);

    const [incidentPrioritySuggestions, setIncidentPrioritySuggestions] = useState([]);
    const [incidentStatusSuggestions, setIncidentStatusSuggestions] = useState([]);
    const [applicationNameSuggestions, setApplicationNameSuggestions] = useState([]);
    const [productNameSuggestions, setProductNameSuggestions] = useState([]);
    const [serviceTierSuggestions, setServiceTierSuggestions] = useState([]);

    useQueryParamChange(selectedBrands[0], onBrandChange);
    useSelectedBrand(selectedBrands[0], onBrandChange, prevSelectedBrand);

    const productMapping = useFetchProductMapping(start, end);
    const [suggestions, setSuggestions] = useState({});

    const {
        handleMouseDown,
        handleMouseMove,
        handleMouseUp,
        chartLeft,
        chartRight,
        refAreaLeft,
        refAreaRight
    } = useZoomAndSynced(
        widgets,
        setWidgets,
        setPendingStart,
        setPendingEnd,
        setCurrentTimeRange,
        setStart,
        setEnd,
        setIsDirtyForm,
        pendingTimeRange
    );

    const PAGES_LIST = [
        {name: 'home', label: 'Home'},
        {name: 'searchresults', label: 'Search'},
        {name: 'property', label: 'Property'},
        {name: 'bookingform', label: 'Booking Form'},
        {name: 'bookingconfirmation', label: 'Booking Confirmation'},
    ];
    const getNowDate = () => moment().endOf('minute').toDate();
    const getLastDate = (value, unit) => moment().subtract(value, unit).startOf('minute').toDate();
    const getValue = (value, unit) => ({start: getLastDate(value, unit), end: getNowDate()});
    const getPresets = () => [
        {text: 'Last 15 minutes', value: getValue(15, 'minutes')},
        {text: 'Last 30 minutes', value: getValue(30, 'minutes')},
        {text: 'Last 1 hour', value: getValue(1, 'hour')},
        {text: 'Last 3 hours', value: getValue(3, 'hours')},
        {text: 'Last 6 hours', value: getValue(6, 'hours')},
        {text: 'Last 12 hours', value: getValue(12, 'hours')},
        {text: 'Last 24 hours', value: getValue(24, 'hours')}
    ];

    const fetchedPageviews = [{"time":"2020-09-28T03:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":58},{"page":"bookingform","views":444},{"page":"home","views":1870},{"page":"property","views":4547},{"page":"searchresults","views":4437}]},{"time":"2020-09-28T03:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":58},{"page":"bookingform","views":386},{"page":"home","views":1772},{"page":"property","views":4806},{"page":"searchresults","views":4401}]},{"time":"2020-09-28T03:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":41},{"page":"bookingform","views":447},{"page":"home","views":1927},{"page":"property","views":4712},{"page":"searchresults","views":4501}]},{"time":"2020-09-28T03:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":36},{"page":"bookingform","views":461},{"page":"home","views":2038},{"page":"property","views":4459},{"page":"searchresults","views":4594}]},{"time":"2020-09-28T03:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":57},{"page":"bookingform","views":411},{"page":"home","views":1664},{"page":"property","views":4155},{"page":"searchresults","views":4435}]},{"time":"2020-09-28T03:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":56},{"page":"bookingform","views":454},{"page":"home","views":1972},{"page":"property","views":4178},{"page":"searchresults","views":4526}]},{"time":"2020-09-28T03:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":51},{"page":"bookingform","views":436},{"page":"home","views":1642},{"page":"property","views":3973},{"page":"searchresults","views":4242}]},{"time":"2020-09-28T03:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":54},{"page":"bookingform","views":415},{"page":"home","views":1756},{"page":"property","views":4295},{"page":"searchresults","views":4378}]},{"time":"2020-09-28T03:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":57},{"page":"bookingform","views":444},{"page":"home","views":1892},{"page":"property","views":4484},{"page":"searchresults","views":4724}]},{"time":"2020-09-28T03:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":374},{"page":"home","views":1992},{"page":"property","views":4291},{"page":"searchresults","views":4265}]},{"time":"2020-09-28T03:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":78},{"page":"bookingform","views":366},{"page":"home","views":1787},{"page":"property","views":4043},{"page":"searchresults","views":4372}]},{"time":"2020-09-28T03:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":62},{"page":"bookingform","views":371},{"page":"home","views":1874},{"page":"property","views":4118},{"page":"searchresults","views":4215}]},{"time":"2020-09-28T03:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":63},{"page":"bookingform","views":577},{"page":"home","views":1912},{"page":"property","views":4460},{"page":"searchresults","views":4429}]},{"time":"2020-09-28T03:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":59},{"page":"bookingform","views":657},{"page":"home","views":1967},{"page":"property","views":4492},{"page":"searchresults","views":4482}]},{"time":"2020-09-28T03:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":407},{"page":"home","views":1605},{"page":"property","views":4046},{"page":"searchresults","views":4229}]},{"time":"2020-09-28T03:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":51},{"page":"bookingform","views":828},{"page":"home","views":1692},{"page":"property","views":4186},{"page":"searchresults","views":4176}]},{"time":"2020-09-28T03:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":869},{"page":"home","views":1643},{"page":"property","views":4206},{"page":"searchresults","views":4257}]},{"time":"2020-09-28T03:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":612},{"page":"home","views":1653},{"page":"property","views":4273},{"page":"searchresults","views":4211}]},{"time":"2020-09-28T03:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":71},{"page":"bookingform","views":710},{"page":"home","views":1766},{"page":"property","views":4686},{"page":"searchresults","views":4277}]},{"time":"2020-09-28T03:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":54},{"page":"bookingform","views":701},{"page":"home","views":1530},{"page":"property","views":3728},{"page":"searchresults","views":3659}]},{"time":"2020-09-28T03:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":61},{"page":"bookingform","views":711},{"page":"home","views":1823},{"page":"property","views":4532},{"page":"searchresults","views":4218}]},{"time":"2020-09-28T03:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":54},{"page":"bookingform","views":837},{"page":"home","views":1776},{"page":"property","views":4112},{"page":"searchresults","views":4204}]},{"time":"2020-09-28T03:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":54},{"page":"bookingform","views":772},{"page":"home","views":1780},{"page":"property","views":4121},{"page":"searchresults","views":4347}]},{"time":"2020-09-28T03:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":46},{"page":"bookingform","views":893},{"page":"home","views":1778},{"page":"property","views":4393},{"page":"searchresults","views":4498}]},{"time":"2020-09-28T03:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":38},{"page":"bookingform","views":885},{"page":"home","views":1701},{"page":"property","views":4006},{"page":"searchresults","views":4218}]},{"time":"2020-09-28T03:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":753},{"page":"home","views":1846},{"page":"property","views":3973},{"page":"searchresults","views":4218}]},{"time":"2020-09-28T03:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":66},{"page":"bookingform","views":827},{"page":"home","views":1826},{"page":"property","views":4015},{"page":"searchresults","views":4063}]},{"time":"2020-09-28T03:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":60},{"page":"bookingform","views":735},{"page":"home","views":1719},{"page":"property","views":3892},{"page":"searchresults","views":4445}]},{"time":"2020-09-28T03:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":71},{"page":"bookingform","views":425},{"page":"home","views":1909},{"page":"property","views":4386},{"page":"searchresults","views":4523}]},{"time":"2020-09-28T03:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":364},{"page":"home","views":1629},{"page":"property","views":3986},{"page":"searchresults","views":4003}]},{"time":"2020-09-28T03:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":364},{"page":"home","views":1579},{"page":"property","views":4042},{"page":"searchresults","views":3918}]},{"time":"2020-09-28T03:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":54},{"page":"bookingform","views":363},{"page":"home","views":1858},{"page":"property","views":4347},{"page":"searchresults","views":4125}]},{"time":"2020-09-28T03:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":36},{"page":"bookingform","views":375},{"page":"home","views":1774},{"page":"property","views":4589},{"page":"searchresults","views":3997}]},{"time":"2020-09-28T03:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":49},{"page":"bookingform","views":399},{"page":"home","views":1758},{"page":"property","views":4954},{"page":"searchresults","views":4297}]},{"time":"2020-09-28T03:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":44},{"page":"bookingform","views":345},{"page":"home","views":1704},{"page":"property","views":4841},{"page":"searchresults","views":4147}]},{"time":"2020-09-28T03:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":42},{"page":"bookingform","views":377},{"page":"home","views":1784},{"page":"property","views":4695},{"page":"searchresults","views":4113}]},{"time":"2020-09-28T03:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":55},{"page":"bookingform","views":346},{"page":"home","views":1652},{"page":"property","views":4698},{"page":"searchresults","views":3879}]},{"time":"2020-09-28T03:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":35},{"page":"bookingform","views":326},{"page":"home","views":1697},{"page":"property","views":4478},{"page":"searchresults","views":3858}]},{"time":"2020-09-28T03:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":58},{"page":"bookingform","views":399},{"page":"home","views":1516},{"page":"property","views":4992},{"page":"searchresults","views":4023}]},{"time":"2020-09-28T03:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":42},{"page":"bookingform","views":394},{"page":"home","views":1558},{"page":"property","views":4473},{"page":"searchresults","views":3776}]},{"time":"2020-09-28T03:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":44},{"page":"bookingform","views":364},{"page":"home","views":1669},{"page":"property","views":4265},{"page":"searchresults","views":3699}]},{"time":"2020-09-28T03:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":53},{"page":"bookingform","views":393},{"page":"home","views":1590},{"page":"property","views":4479},{"page":"searchresults","views":4052}]},{"time":"2020-09-28T03:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":59},{"page":"bookingform","views":346},{"page":"home","views":1709},{"page":"property","views":4479},{"page":"searchresults","views":3981}]},{"time":"2020-09-28T03:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":41},{"page":"bookingform","views":379},{"page":"home","views":1721},{"page":"property","views":4769},{"page":"searchresults","views":4163}]},{"time":"2020-09-28T03:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":42},{"page":"bookingform","views":295},{"page":"home","views":1375},{"page":"property","views":4425},{"page":"searchresults","views":3992}]},{"time":"2020-09-28T03:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":51},{"page":"bookingform","views":302},{"page":"home","views":1597},{"page":"property","views":4309},{"page":"searchresults","views":3861}]},{"time":"2020-09-28T03:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":46},{"page":"bookingform","views":308},{"page":"home","views":1661},{"page":"property","views":4370},{"page":"searchresults","views":3866}]},{"time":"2020-09-28T03:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":40},{"page":"bookingform","views":266},{"page":"home","views":1494},{"page":"property","views":4113},{"page":"searchresults","views":3608}]},{"time":"2020-09-28T03:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":53},{"page":"bookingform","views":401},{"page":"home","views":1678},{"page":"property","views":4539},{"page":"searchresults","views":4150}]},{"time":"2020-09-28T03:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":279},{"page":"home","views":1442},{"page":"property","views":4236},{"page":"searchresults","views":3725}]},{"time":"2020-09-28T03:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":42},{"page":"bookingform","views":300},{"page":"home","views":1542},{"page":"property","views":4278},{"page":"searchresults","views":3721}]},{"time":"2020-09-28T03:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":51},{"page":"bookingform","views":322},{"page":"home","views":1649},{"page":"property","views":4332},{"page":"searchresults","views":3921}]},{"time":"2020-09-28T03:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":310},{"page":"home","views":1614},{"page":"property","views":4419},{"page":"searchresults","views":3885}]},{"time":"2020-09-28T03:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":46},{"page":"bookingform","views":318},{"page":"home","views":1695},{"page":"property","views":4648},{"page":"searchresults","views":4042}]},{"time":"2020-09-28T03:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":46},{"page":"bookingform","views":330},{"page":"home","views":1553},{"page":"property","views":4279},{"page":"searchresults","views":3800}]},{"time":"2020-09-28T03:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":41},{"page":"bookingform","views":341},{"page":"home","views":1553},{"page":"property","views":4248},{"page":"searchresults","views":3610}]},{"time":"2020-09-28T03:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":56},{"page":"bookingform","views":345},{"page":"home","views":1436},{"page":"property","views":4309},{"page":"searchresults","views":3685}]},{"time":"2020-09-28T03:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":49},{"page":"bookingform","views":308},{"page":"home","views":1525},{"page":"property","views":4347},{"page":"searchresults","views":3780}]},{"time":"2020-09-28T03:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":29},{"page":"bookingform","views":531},{"page":"home","views":1695},{"page":"property","views":4781},{"page":"searchresults","views":4064}]},{"time":"2020-09-28T04:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":44},{"page":"bookingform","views":601},{"page":"home","views":1366},{"page":"property","views":3851},{"page":"searchresults","views":3615}]},{"time":"2020-09-28T04:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":36},{"page":"bookingform","views":727},{"page":"home","views":1557},{"page":"property","views":3985},{"page":"searchresults","views":3705}]},{"time":"2020-09-28T04:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":818},{"page":"home","views":1507},{"page":"property","views":3965},{"page":"searchresults","views":3564}]},{"time":"2020-09-28T04:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":39},{"page":"bookingform","views":650},{"page":"home","views":1385},{"page":"property","views":4251},{"page":"searchresults","views":3622}]},{"time":"2020-09-28T04:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":44},{"page":"bookingform","views":734},{"page":"home","views":1521},{"page":"property","views":4132},{"page":"searchresults","views":3765}]},{"time":"2020-09-28T04:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":38},{"page":"bookingform","views":739},{"page":"home","views":1512},{"page":"property","views":3999},{"page":"searchresults","views":3655}]},{"time":"2020-09-28T04:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":39},{"page":"bookingform","views":1024},{"page":"home","views":1466},{"page":"property","views":3716},{"page":"searchresults","views":3493}]},{"time":"2020-09-28T04:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":60},{"page":"bookingform","views":1168},{"page":"home","views":1518},{"page":"property","views":4071},{"page":"searchresults","views":3537}]},{"time":"2020-09-28T04:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":41},{"page":"bookingform","views":924},{"page":"home","views":1424},{"page":"property","views":3947},{"page":"searchresults","views":3451}]},{"time":"2020-09-28T04:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":1010},{"page":"home","views":1522},{"page":"property","views":4320},{"page":"searchresults","views":3850}]},{"time":"2020-09-28T04:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":931},{"page":"home","views":1423},{"page":"property","views":4151},{"page":"searchresults","views":3598}]},{"time":"2020-09-28T04:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":43},{"page":"bookingform","views":673},{"page":"home","views":1508},{"page":"property","views":4300},{"page":"searchresults","views":3614}]},{"time":"2020-09-28T04:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":50},{"page":"bookingform","views":370},{"page":"home","views":1439},{"page":"property","views":4063},{"page":"searchresults","views":3517}]},{"time":"2020-09-28T04:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":35},{"page":"bookingform","views":313},{"page":"home","views":1350},{"page":"property","views":3933},{"page":"searchresults","views":3357}]},{"time":"2020-09-28T04:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":364},{"page":"home","views":1405},{"page":"property","views":4217},{"page":"searchresults","views":3809}]},{"time":"2020-09-28T04:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":312},{"page":"home","views":1307},{"page":"property","views":4006},{"page":"searchresults","views":3463}]},{"time":"2020-09-28T04:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":339},{"page":"home","views":1378},{"page":"property","views":3905},{"page":"searchresults","views":3492}]},{"time":"2020-09-28T04:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":322},{"page":"home","views":1493},{"page":"property","views":3990},{"page":"searchresults","views":3617}]},{"time":"2020-09-28T04:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":308},{"page":"home","views":1326},{"page":"property","views":4134},{"page":"searchresults","views":3514}]},{"time":"2020-09-28T04:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":47},{"page":"bookingform","views":347},{"page":"home","views":1533},{"page":"property","views":4289},{"page":"searchresults","views":3590}]},{"time":"2020-09-28T04:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":314},{"page":"home","views":1396},{"page":"property","views":3892},{"page":"searchresults","views":3407}]},{"time":"2020-09-28T04:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":346},{"page":"home","views":1329},{"page":"property","views":3957},{"page":"searchresults","views":3399}]},{"time":"2020-09-28T04:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":296},{"page":"home","views":1295},{"page":"property","views":3878},{"page":"searchresults","views":3450}]},{"time":"2020-09-28T04:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":272},{"page":"home","views":1301},{"page":"property","views":3998},{"page":"searchresults","views":3656}]},{"time":"2020-09-28T04:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":52},{"page":"bookingform","views":323},{"page":"home","views":1360},{"page":"property","views":3881},{"page":"searchresults","views":3664}]},{"time":"2020-09-28T04:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":43},{"page":"bookingform","views":264},{"page":"home","views":1328},{"page":"property","views":3903},{"page":"searchresults","views":3486}]},{"time":"2020-09-28T04:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":39},{"page":"bookingform","views":276},{"page":"home","views":1537},{"page":"property","views":3711},{"page":"searchresults","views":3536}]},{"time":"2020-09-28T04:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":35},{"page":"bookingform","views":278},{"page":"home","views":1384},{"page":"property","views":3934},{"page":"searchresults","views":3457}]},{"time":"2020-09-28T04:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":233},{"page":"home","views":1386},{"page":"property","views":3703},{"page":"searchresults","views":3674}]},{"time":"2020-09-28T04:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":44},{"page":"bookingform","views":296},{"page":"home","views":1439},{"page":"property","views":4010},{"page":"searchresults","views":3788}]},{"time":"2020-09-28T04:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":280},{"page":"home","views":1298},{"page":"property","views":3756},{"page":"searchresults","views":3482}]},{"time":"2020-09-28T04:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":38},{"page":"bookingform","views":261},{"page":"home","views":1387},{"page":"property","views":3902},{"page":"searchresults","views":3424}]},{"time":"2020-09-28T04:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":250},{"page":"home","views":1405},{"page":"property","views":3985},{"page":"searchresults","views":3596}]},{"time":"2020-09-28T04:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":276},{"page":"home","views":1321},{"page":"property","views":3991},{"page":"searchresults","views":3478}]},{"time":"2020-09-28T04:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":35},{"page":"bookingform","views":315},{"page":"home","views":1291},{"page":"property","views":3706},{"page":"searchresults","views":3477}]},{"time":"2020-09-28T04:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":221},{"page":"home","views":1205},{"page":"property","views":3762},{"page":"searchresults","views":3367}]},{"time":"2020-09-28T04:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":260},{"page":"home","views":1269},{"page":"property","views":3687},{"page":"searchresults","views":3371}]},{"time":"2020-09-28T04:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":301},{"page":"home","views":1231},{"page":"property","views":3775},{"page":"searchresults","views":3298}]},{"time":"2020-09-28T04:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":48},{"page":"bookingform","views":214},{"page":"home","views":1328},{"page":"property","views":3949},{"page":"searchresults","views":3402}]},{"time":"2020-09-28T04:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":45},{"page":"bookingform","views":295},{"page":"home","views":1252},{"page":"property","views":4043},{"page":"searchresults","views":3516}]},{"time":"2020-09-28T04:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":41},{"page":"bookingform","views":232},{"page":"home","views":1197},{"page":"property","views":3553},{"page":"searchresults","views":3240}]},{"time":"2020-09-28T04:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":292},{"page":"home","views":1246},{"page":"property","views":3528},{"page":"searchresults","views":3384}]},{"time":"2020-09-28T04:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":281},{"page":"home","views":1220},{"page":"property","views":3438},{"page":"searchresults","views":3214}]},{"time":"2020-09-28T04:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":228},{"page":"home","views":1162},{"page":"property","views":3472},{"page":"searchresults","views":3225}]},{"time":"2020-09-28T04:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":319},{"page":"home","views":1269},{"page":"property","views":3830},{"page":"searchresults","views":3452}]},{"time":"2020-09-28T04:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":263},{"page":"home","views":1120},{"page":"property","views":3401},{"page":"searchresults","views":2970}]},{"time":"2020-09-28T04:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":256},{"page":"home","views":1273},{"page":"property","views":3628},{"page":"searchresults","views":3050}]},{"time":"2020-09-28T04:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":222},{"page":"home","views":1302},{"page":"property","views":3821},{"page":"searchresults","views":3175}]},{"time":"2020-09-28T04:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":262},{"page":"home","views":1130},{"page":"property","views":3691},{"page":"searchresults","views":3119}]},{"time":"2020-09-28T04:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":36},{"page":"bookingform","views":258},{"page":"home","views":1284},{"page":"property","views":4270},{"page":"searchresults","views":3406}]},{"time":"2020-09-28T04:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":275},{"page":"home","views":1210},{"page":"property","views":4139},{"page":"searchresults","views":3035}]},{"time":"2020-09-28T04:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":235},{"page":"home","views":1155},{"page":"property","views":3950},{"page":"searchresults","views":3176}]},{"time":"2020-09-28T04:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":263},{"page":"home","views":1169},{"page":"property","views":4187},{"page":"searchresults","views":3119}]},{"time":"2020-09-28T04:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":300},{"page":"home","views":1166},{"page":"property","views":4380},{"page":"searchresults","views":3075}]},{"time":"2020-09-28T04:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":29},{"page":"bookingform","views":261},{"page":"home","views":1205},{"page":"property","views":4561},{"page":"searchresults","views":3166}]},{"time":"2020-09-28T04:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":284},{"page":"home","views":1205},{"page":"property","views":3982},{"page":"searchresults","views":2884}]},{"time":"2020-09-28T04:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":39},{"page":"bookingform","views":192},{"page":"home","views":1175},{"page":"property","views":3695},{"page":"searchresults","views":2817}]},{"time":"2020-09-28T04:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":28},{"page":"bookingform","views":244},{"page":"home","views":1243},{"page":"property","views":3891},{"page":"searchresults","views":2805}]},{"time":"2020-09-28T04:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":254},{"page":"home","views":1163},{"page":"property","views":3918},{"page":"searchresults","views":2679}]},{"time":"2020-09-28T04:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":241},{"page":"home","views":1143},{"page":"property","views":4087},{"page":"searchresults","views":3106}]},{"time":"2020-09-28T05:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":247},{"page":"home","views":1156},{"page":"property","views":3841},{"page":"searchresults","views":2890}]},{"time":"2020-09-28T05:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":29},{"page":"bookingform","views":215},{"page":"home","views":1087},{"page":"property","views":3648},{"page":"searchresults","views":2819}]},{"time":"2020-09-28T05:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":232},{"page":"home","views":1182},{"page":"property","views":3759},{"page":"searchresults","views":2893}]},{"time":"2020-09-28T05:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":35},{"page":"bookingform","views":234},{"page":"home","views":1270},{"page":"property","views":3802},{"page":"searchresults","views":2981}]},{"time":"2020-09-28T05:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":40},{"page":"bookingform","views":232},{"page":"home","views":1232},{"page":"property","views":3944},{"page":"searchresults","views":2992}]},{"time":"2020-09-28T05:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":24},{"page":"bookingform","views":212},{"page":"home","views":971},{"page":"property","views":3441},{"page":"searchresults","views":2784}]},{"time":"2020-09-28T05:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":28},{"page":"bookingform","views":182},{"page":"home","views":1171},{"page":"property","views":3522},{"page":"searchresults","views":2907}]},{"time":"2020-09-28T05:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":233},{"page":"home","views":1107},{"page":"property","views":3528},{"page":"searchresults","views":2946}]},{"time":"2020-09-28T05:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":189},{"page":"home","views":1081},{"page":"property","views":3641},{"page":"searchresults","views":2882}]},{"time":"2020-09-28T05:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":276},{"page":"home","views":1259},{"page":"property","views":3826},{"page":"searchresults","views":3117}]},{"time":"2020-09-28T05:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":28},{"page":"bookingform","views":247},{"page":"home","views":1049},{"page":"property","views":3518},{"page":"searchresults","views":2823}]},{"time":"2020-09-28T05:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":270},{"page":"home","views":1122},{"page":"property","views":3524},{"page":"searchresults","views":2781}]},{"time":"2020-09-28T05:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":29},{"page":"bookingform","views":219},{"page":"home","views":1173},{"page":"property","views":3474},{"page":"searchresults","views":2917}]},{"time":"2020-09-28T05:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":42},{"page":"bookingform","views":221},{"page":"home","views":1086},{"page":"property","views":3506},{"page":"searchresults","views":2759}]},{"time":"2020-09-28T05:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":249},{"page":"home","views":1133},{"page":"property","views":3873},{"page":"searchresults","views":3014}]},{"time":"2020-09-28T05:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":187},{"page":"home","views":977},{"page":"property","views":3507},{"page":"searchresults","views":2793}]},{"time":"2020-09-28T05:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":230},{"page":"home","views":1045},{"page":"property","views":3457},{"page":"searchresults","views":2728}]},{"time":"2020-09-28T05:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":194},{"page":"home","views":1099},{"page":"property","views":3571},{"page":"searchresults","views":2908}]},{"time":"2020-09-28T05:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":234},{"page":"home","views":1055},{"page":"property","views":3518},{"page":"searchresults","views":2843}]},{"time":"2020-09-28T05:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":225},{"page":"home","views":1048},{"page":"property","views":3667},{"page":"searchresults","views":2910}]},{"time":"2020-09-28T05:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":219},{"page":"home","views":1031},{"page":"property","views":3558},{"page":"searchresults","views":2609}]},{"time":"2020-09-28T05:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":210},{"page":"home","views":972},{"page":"property","views":3326},{"page":"searchresults","views":2751}]},{"time":"2020-09-28T05:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":27},{"page":"bookingform","views":210},{"page":"home","views":1077},{"page":"property","views":3409},{"page":"searchresults","views":2703}]},{"time":"2020-09-28T05:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":191},{"page":"home","views":997},{"page":"property","views":3436},{"page":"searchresults","views":2597}]},{"time":"2020-09-28T05:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":27},{"page":"bookingform","views":235},{"page":"home","views":1035},{"page":"property","views":3452},{"page":"searchresults","views":2930}]},{"time":"2020-09-28T05:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":192},{"page":"home","views":990},{"page":"property","views":3273},{"page":"searchresults","views":2612}]},{"time":"2020-09-28T05:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":197},{"page":"home","views":931},{"page":"property","views":3119},{"page":"searchresults","views":2523}]},{"time":"2020-09-28T05:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":435},{"page":"home","views":1055},{"page":"property","views":3109},{"page":"searchresults","views":2764}]},{"time":"2020-09-28T05:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":360},{"page":"home","views":1054},{"page":"property","views":3215},{"page":"searchresults","views":2734}]},{"time":"2020-09-28T05:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":28},{"page":"bookingform","views":519},{"page":"home","views":1114},{"page":"property","views":3623},{"page":"searchresults","views":2962}]},{"time":"2020-09-28T05:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":457},{"page":"home","views":1062},{"page":"property","views":3336},{"page":"searchresults","views":2679}]},{"time":"2020-09-28T05:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":256},{"page":"home","views":1039},{"page":"property","views":3318},{"page":"searchresults","views":2660}]},{"time":"2020-09-28T05:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":37},{"page":"bookingform","views":439},{"page":"home","views":1017},{"page":"property","views":3276},{"page":"searchresults","views":2575}]},{"time":"2020-09-28T05:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":388},{"page":"home","views":1093},{"page":"property","views":3531},{"page":"searchresults","views":2795}]},{"time":"2020-09-28T05:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":434},{"page":"home","views":1061},{"page":"property","views":3558},{"page":"searchresults","views":2691}]},{"time":"2020-09-28T05:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":31},{"page":"bookingform","views":344},{"page":"home","views":1027},{"page":"property","views":3361},{"page":"searchresults","views":2658}]},{"time":"2020-09-28T05:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":293},{"page":"home","views":1044},{"page":"property","views":3229},{"page":"searchresults","views":2700}]},{"time":"2020-09-28T05:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":271},{"page":"home","views":954},{"page":"property","views":3334},{"page":"searchresults","views":2577}]},{"time":"2020-09-28T05:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":680},{"page":"home","views":1013},{"page":"property","views":3372},{"page":"searchresults","views":2578}]},{"time":"2020-09-28T05:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":790},{"page":"home","views":1037},{"page":"property","views":3645},{"page":"searchresults","views":2565}]},{"time":"2020-09-28T05:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":32},{"page":"bookingform","views":392},{"page":"home","views":920},{"page":"property","views":3302},{"page":"searchresults","views":2477}]},{"time":"2020-09-28T05:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":27},{"page":"bookingform","views":531},{"page":"home","views":937},{"page":"property","views":3374},{"page":"searchresults","views":2510}]},{"time":"2020-09-28T05:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":973},{"page":"home","views":1014},{"page":"property","views":3200},{"page":"searchresults","views":2601}]},{"time":"2020-09-28T05:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":740},{"page":"home","views":999},{"page":"property","views":3486},{"page":"searchresults","views":2505}]},{"time":"2020-09-28T05:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":30},{"page":"bookingform","views":877},{"page":"home","views":962},{"page":"property","views":3707},{"page":"searchresults","views":2529}]},{"time":"2020-09-28T05:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":33},{"page":"bookingform","views":766},{"page":"home","views":933},{"page":"property","views":3769},{"page":"searchresults","views":2486}]},{"time":"2020-09-28T05:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":712},{"page":"home","views":994},{"page":"property","views":3574},{"page":"searchresults","views":2382}]},{"time":"2020-09-28T05:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":508},{"page":"home","views":1024},{"page":"property","views":3628},{"page":"searchresults","views":2619}]},{"time":"2020-09-28T05:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":216},{"page":"home","views":960},{"page":"property","views":3591},{"page":"searchresults","views":2494}]},{"time":"2020-09-28T05:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":27},{"page":"bookingform","views":207},{"page":"home","views":1095},{"page":"property","views":3678},{"page":"searchresults","views":2497}]},{"time":"2020-09-28T05:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":198},{"page":"home","views":886},{"page":"property","views":3311},{"page":"searchresults","views":2406}]},{"time":"2020-09-28T05:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":27},{"page":"bookingform","views":197},{"page":"home","views":904},{"page":"property","views":3661},{"page":"searchresults","views":2301}]},{"time":"2020-09-28T05:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":209},{"page":"home","views":1115},{"page":"property","views":3608},{"page":"searchresults","views":2387}]},{"time":"2020-09-28T05:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":233},{"page":"home","views":995},{"page":"property","views":3680},{"page":"searchresults","views":2354}]},{"time":"2020-09-28T05:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":29},{"page":"bookingform","views":194},{"page":"home","views":971},{"page":"property","views":3455},{"page":"searchresults","views":2395}]},{"time":"2020-09-28T05:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":210},{"page":"home","views":942},{"page":"property","views":3141},{"page":"searchresults","views":2239}]},{"time":"2020-09-28T05:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":208},{"page":"home","views":988},{"page":"property","views":3165},{"page":"searchresults","views":2185}]},{"time":"2020-09-28T05:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":197},{"page":"home","views":842},{"page":"property","views":3275},{"page":"searchresults","views":2184}]},{"time":"2020-09-28T05:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":207},{"page":"home","views":786},{"page":"property","views":3266},{"page":"searchresults","views":2197}]},{"time":"2020-09-28T05:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":36},{"page":"bookingform","views":304},{"page":"home","views":1054},{"page":"property","views":3728},{"page":"searchresults","views":2533}]},{"time":"2020-09-28T06:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":175},{"page":"home","views":807},{"page":"property","views":3222},{"page":"searchresults","views":2340}]},{"time":"2020-09-28T06:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":285},{"page":"home","views":868},{"page":"property","views":3216},{"page":"searchresults","views":2175}]},{"time":"2020-09-28T06:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":364},{"page":"home","views":917},{"page":"property","views":3489},{"page":"searchresults","views":2229}]},{"time":"2020-09-28T06:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":34},{"page":"bookingform","views":302},{"page":"home","views":870},{"page":"property","views":3528},{"page":"searchresults","views":2307}]},{"time":"2020-09-28T06:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":382},{"page":"home","views":916},{"page":"property","views":3590},{"page":"searchresults","views":2358}]},{"time":"2020-09-28T06:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":24},{"page":"bookingform","views":261},{"page":"home","views":781},{"page":"property","views":3144},{"page":"searchresults","views":2353}]},{"time":"2020-09-28T06:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":394},{"page":"home","views":957},{"page":"property","views":3145},{"page":"searchresults","views":2249}]},{"time":"2020-09-28T06:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":303},{"page":"home","views":844},{"page":"property","views":3357},{"page":"searchresults","views":2331}]},{"time":"2020-09-28T06:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":365},{"page":"home","views":836},{"page":"property","views":2999},{"page":"searchresults","views":2271}]},{"time":"2020-09-28T06:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":354},{"page":"home","views":962},{"page":"property","views":3740},{"page":"searchresults","views":2474}]},{"time":"2020-09-28T06:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":282},{"page":"home","views":901},{"page":"property","views":3308},{"page":"searchresults","views":2245}]},{"time":"2020-09-28T06:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":370},{"page":"home","views":884},{"page":"property","views":3289},{"page":"searchresults","views":2228}]},{"time":"2020-09-28T06:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":303},{"page":"home","views":866},{"page":"property","views":3413},{"page":"searchresults","views":2118}]},{"time":"2020-09-28T06:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":246},{"page":"home","views":876},{"page":"property","views":3363},{"page":"searchresults","views":2151}]},{"time":"2020-09-28T06:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":508},{"page":"home","views":871},{"page":"property","views":3411},{"page":"searchresults","views":2200}]},{"time":"2020-09-28T06:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":560},{"page":"home","views":866},{"page":"property","views":3448},{"page":"searchresults","views":2235}]},{"time":"2020-09-28T06:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":454},{"page":"home","views":838},{"page":"property","views":3192},{"page":"searchresults","views":2208}]},{"time":"2020-09-28T06:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":216},{"page":"home","views":911},{"page":"property","views":3503},{"page":"searchresults","views":2245}]},{"time":"2020-09-28T06:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":250},{"page":"home","views":838},{"page":"property","views":3249},{"page":"searchresults","views":2159}]},{"time":"2020-09-28T06:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":499},{"page":"home","views":969},{"page":"property","views":3387},{"page":"searchresults","views":2086}]},{"time":"2020-09-28T06:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":831},{"page":"home","views":894},{"page":"property","views":3299},{"page":"searchresults","views":1924}]},{"time":"2020-09-28T06:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":402},{"page":"home","views":882},{"page":"property","views":3391},{"page":"searchresults","views":2060}]},{"time":"2020-09-28T06:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":582},{"page":"home","views":878},{"page":"property","views":3533},{"page":"searchresults","views":2044}]},{"time":"2020-09-28T06:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":400},{"page":"home","views":770},{"page":"property","views":4121},{"page":"searchresults","views":2209}]},{"time":"2020-09-28T06:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":588},{"page":"home","views":964},{"page":"property","views":3863},{"page":"searchresults","views":2403}]},{"time":"2020-09-28T06:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":557},{"page":"home","views":787},{"page":"property","views":3365},{"page":"searchresults","views":2057}]},{"time":"2020-09-28T06:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":664},{"page":"home","views":905},{"page":"property","views":3348},{"page":"searchresults","views":2028}]},{"time":"2020-09-28T06:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":524},{"page":"home","views":867},{"page":"property","views":3240},{"page":"searchresults","views":2094}]},{"time":"2020-09-28T06:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":213},{"page":"home","views":921},{"page":"property","views":3544},{"page":"searchresults","views":2377}]},{"time":"2020-09-28T06:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":277},{"page":"home","views":878},{"page":"property","views":3660},{"page":"searchresults","views":2239}]},{"time":"2020-09-28T06:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":355},{"page":"home","views":812},{"page":"property","views":3264},{"page":"searchresults","views":2267}]},{"time":"2020-09-28T06:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":330},{"page":"home","views":875},{"page":"property","views":3455},{"page":"searchresults","views":2121}]},{"time":"2020-09-28T06:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":336},{"page":"home","views":832},{"page":"property","views":3463},{"page":"searchresults","views":2291}]},{"time":"2020-09-28T06:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":426},{"page":"home","views":746},{"page":"property","views":3358},{"page":"searchresults","views":2190}]},{"time":"2020-09-28T06:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":625},{"page":"home","views":851},{"page":"property","views":3441},{"page":"searchresults","views":2332}]},{"time":"2020-09-28T06:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":744},{"page":"home","views":797},{"page":"property","views":3407},{"page":"searchresults","views":2075}]},{"time":"2020-09-28T06:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":733},{"page":"home","views":940},{"page":"property","views":3312},{"page":"searchresults","views":2006}]},{"time":"2020-09-28T06:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":681},{"page":"home","views":844},{"page":"property","views":2998},{"page":"searchresults","views":2181}]},{"time":"2020-09-28T06:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":581},{"page":"home","views":965},{"page":"property","views":3421},{"page":"searchresults","views":2264}]},{"time":"2020-09-28T06:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":771},{"page":"home","views":969},{"page":"property","views":3560},{"page":"searchresults","views":2288}]},{"time":"2020-09-28T06:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":24},{"page":"bookingform","views":790},{"page":"home","views":764},{"page":"property","views":3121},{"page":"searchresults","views":2198}]},{"time":"2020-09-28T06:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":639},{"page":"home","views":858},{"page":"property","views":3301},{"page":"searchresults","views":2145}]},{"time":"2020-09-28T06:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":707},{"page":"home","views":852},{"page":"property","views":3565},{"page":"searchresults","views":2184}]},{"time":"2020-09-28T06:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":728},{"page":"home","views":914},{"page":"property","views":3725},{"page":"searchresults","views":2199}]},{"time":"2020-09-28T06:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":868},{"page":"home","views":863},{"page":"property","views":3597},{"page":"searchresults","views":2193}]},{"time":"2020-09-28T06:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":733},{"page":"home","views":788},{"page":"property","views":3218},{"page":"searchresults","views":2022}]},{"time":"2020-09-28T06:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":758},{"page":"home","views":855},{"page":"property","views":3321},{"page":"searchresults","views":2021}]},{"time":"2020-09-28T06:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":693},{"page":"home","views":868},{"page":"property","views":3356},{"page":"searchresults","views":2032}]},{"time":"2020-09-28T06:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":710},{"page":"home","views":824},{"page":"property","views":3462},{"page":"searchresults","views":2026}]},{"time":"2020-09-28T06:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":805},{"page":"home","views":879},{"page":"property","views":3844},{"page":"searchresults","views":2176}]},{"time":"2020-09-28T06:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":704},{"page":"home","views":786},{"page":"property","views":3321},{"page":"searchresults","views":1974}]},{"time":"2020-09-28T06:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":1136},{"page":"home","views":910},{"page":"property","views":3440},{"page":"searchresults","views":2075}]},{"time":"2020-09-28T06:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":712},{"page":"home","views":773},{"page":"property","views":3261},{"page":"searchresults","views":1978}]},{"time":"2020-09-28T06:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":813},{"page":"home","views":795},{"page":"property","views":3496},{"page":"searchresults","views":2015}]},{"time":"2020-09-28T06:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":25},{"page":"bookingform","views":839},{"page":"home","views":951},{"page":"property","views":3620},{"page":"searchresults","views":2319}]},{"time":"2020-09-28T06:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":1015},{"page":"home","views":766},{"page":"property","views":3641},{"page":"searchresults","views":2006}]},{"time":"2020-09-28T06:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":659},{"page":"home","views":878},{"page":"property","views":3546},{"page":"searchresults","views":1908}]},{"time":"2020-09-28T06:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":223},{"page":"home","views":821},{"page":"property","views":3376},{"page":"searchresults","views":1873}]},{"time":"2020-09-28T06:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":235},{"page":"home","views":769},{"page":"property","views":3324},{"page":"searchresults","views":1831}]},{"time":"2020-09-28T06:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":825},{"page":"home","views":920},{"page":"property","views":3698},{"page":"searchresults","views":2002}]},{"time":"2020-09-28T07:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":841},{"page":"home","views":825},{"page":"property","views":3268},{"page":"searchresults","views":1786}]},{"time":"2020-09-28T07:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":824},{"page":"home","views":894},{"page":"property","views":3553},{"page":"searchresults","views":1895}]},{"time":"2020-09-28T07:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":585},{"page":"home","views":833},{"page":"property","views":3415},{"page":"searchresults","views":1752}]},{"time":"2020-09-28T07:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":427},{"page":"home","views":884},{"page":"property","views":3825},{"page":"searchresults","views":1999}]},{"time":"2020-09-28T07:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":576},{"page":"home","views":1105},{"page":"property","views":4068},{"page":"searchresults","views":2049}]},{"time":"2020-09-28T07:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":439},{"page":"home","views":860},{"page":"property","views":3534},{"page":"searchresults","views":1825}]},{"time":"2020-09-28T07:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":541},{"page":"home","views":1079},{"page":"property","views":3762},{"page":"searchresults","views":1954}]},{"time":"2020-09-28T07:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":782},{"page":"home","views":955},{"page":"property","views":3709},{"page":"searchresults","views":1881}]},{"time":"2020-09-28T07:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":724},{"page":"home","views":907},{"page":"property","views":3778},{"page":"searchresults","views":1866}]},{"time":"2020-09-28T07:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":574},{"page":"home","views":974},{"page":"property","views":3991},{"page":"searchresults","views":1880}]},{"time":"2020-09-28T07:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":521},{"page":"home","views":850},{"page":"property","views":3580},{"page":"searchresults","views":1915}]},{"time":"2020-09-28T07:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":646},{"page":"home","views":962},{"page":"property","views":3972},{"page":"searchresults","views":2043}]},{"time":"2020-09-28T07:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":582},{"page":"home","views":847},{"page":"property","views":4106},{"page":"searchresults","views":1931}]},{"time":"2020-09-28T07:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":7},{"page":"bookingform","views":562},{"page":"home","views":899},{"page":"property","views":3968},{"page":"searchresults","views":1992}]},{"time":"2020-09-28T07:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":642},{"page":"home","views":838},{"page":"property","views":3861},{"page":"searchresults","views":1988}]},{"time":"2020-09-28T07:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":519},{"page":"home","views":811},{"page":"property","views":4048},{"page":"searchresults","views":1817}]},{"time":"2020-09-28T07:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":643},{"page":"home","views":946},{"page":"property","views":3774},{"page":"searchresults","views":1865}]},{"time":"2020-09-28T07:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":782},{"page":"home","views":888},{"page":"property","views":3706},{"page":"searchresults","views":1812}]},{"time":"2020-09-28T07:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":760},{"page":"home","views":734},{"page":"property","views":3638},{"page":"searchresults","views":1905}]},{"time":"2020-09-28T07:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":716},{"page":"home","views":924},{"page":"property","views":4023},{"page":"searchresults","views":1880}]},{"time":"2020-09-28T07:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":1010},{"page":"home","views":740},{"page":"property","views":3737},{"page":"searchresults","views":1875}]},{"time":"2020-09-28T07:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":490},{"page":"home","views":889},{"page":"property","views":3541},{"page":"searchresults","views":1906}]},{"time":"2020-09-28T07:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":892},{"page":"home","views":854},{"page":"property","views":3714},{"page":"searchresults","views":1784}]},{"time":"2020-09-28T07:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":710},{"page":"home","views":895},{"page":"property","views":3998},{"page":"searchresults","views":1866}]},{"time":"2020-09-28T07:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":864},{"page":"home","views":842},{"page":"property","views":3976},{"page":"searchresults","views":1850}]},{"time":"2020-09-28T07:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":8},{"page":"bookingform","views":643},{"page":"home","views":785},{"page":"property","views":3536},{"page":"searchresults","views":1700}]},{"time":"2020-09-28T07:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":731},{"page":"home","views":809},{"page":"property","views":3588},{"page":"searchresults","views":1765}]},{"time":"2020-09-28T07:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":1008},{"page":"home","views":786},{"page":"property","views":3800},{"page":"searchresults","views":1763}]},{"time":"2020-09-28T07:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":1065},{"page":"home","views":841},{"page":"property","views":3713},{"page":"searchresults","views":1839}]},{"time":"2020-09-28T07:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":1102},{"page":"home","views":884},{"page":"property","views":3831},{"page":"searchresults","views":1971}]},{"time":"2020-09-28T07:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":355},{"page":"home","views":755},{"page":"property","views":3900},{"page":"searchresults","views":1834}]},{"time":"2020-09-28T07:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":6},{"page":"bookingform","views":1150},{"page":"home","views":816},{"page":"property","views":3785},{"page":"searchresults","views":1773}]},{"time":"2020-09-28T07:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":1057},{"page":"home","views":883},{"page":"property","views":3992},{"page":"searchresults","views":1861}]},{"time":"2020-09-28T07:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":860},{"page":"home","views":899},{"page":"property","views":3898},{"page":"searchresults","views":1848}]},{"time":"2020-09-28T07:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":915},{"page":"home","views":881},{"page":"property","views":3779},{"page":"searchresults","views":1873}]},{"time":"2020-09-28T07:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":483},{"page":"home","views":853},{"page":"property","views":3434},{"page":"searchresults","views":1811}]},{"time":"2020-09-28T07:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":265},{"page":"home","views":786},{"page":"property","views":3396},{"page":"searchresults","views":1829}]},{"time":"2020-09-28T07:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":280},{"page":"home","views":888},{"page":"property","views":3346},{"page":"searchresults","views":1834}]},{"time":"2020-09-28T07:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":250},{"page":"home","views":814},{"page":"property","views":3605},{"page":"searchresults","views":1789}]},{"time":"2020-09-28T07:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":258},{"page":"home","views":828},{"page":"property","views":3702},{"page":"searchresults","views":1903}]},{"time":"2020-09-28T07:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":249},{"page":"home","views":751},{"page":"property","views":3441},{"page":"searchresults","views":1940}]},{"time":"2020-09-28T07:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":526},{"page":"home","views":875},{"page":"property","views":3485},{"page":"searchresults","views":1747}]},{"time":"2020-09-28T07:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":8},{"page":"bookingform","views":236},{"page":"home","views":828},{"page":"property","views":3350},{"page":"searchresults","views":1781}]},{"time":"2020-09-28T07:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":9},{"page":"bookingform","views":249},{"page":"home","views":829},{"page":"property","views":3193},{"page":"searchresults","views":1885}]},{"time":"2020-09-28T07:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":668},{"page":"home","views":822},{"page":"property","views":3329},{"page":"searchresults","views":1954}]},{"time":"2020-09-28T07:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":752},{"page":"home","views":673},{"page":"property","views":3244},{"page":"searchresults","views":1788}]},{"time":"2020-09-28T07:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":723},{"page":"home","views":745},{"page":"property","views":3108},{"page":"searchresults","views":1771}]},{"time":"2020-09-28T07:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":669},{"page":"home","views":727},{"page":"property","views":3170},{"page":"searchresults","views":1773}]},{"time":"2020-09-28T07:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":26},{"page":"bookingform","views":807},{"page":"home","views":796},{"page":"property","views":3130},{"page":"searchresults","views":1793}]},{"time":"2020-09-28T07:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":469},{"page":"home","views":851},{"page":"property","views":3300},{"page":"searchresults","views":1896}]},{"time":"2020-09-28T07:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":9},{"page":"bookingform","views":308},{"page":"home","views":778},{"page":"property","views":3027},{"page":"searchresults","views":1622}]},{"time":"2020-09-28T07:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":520},{"page":"home","views":826},{"page":"property","views":3157},{"page":"searchresults","views":1602}]},{"time":"2020-09-28T07:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":595},{"page":"home","views":713},{"page":"property","views":2950},{"page":"searchresults","views":1655}]},{"time":"2020-09-28T07:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":633},{"page":"home","views":888},{"page":"property","views":3039},{"page":"searchresults","views":1530}]},{"time":"2020-09-28T07:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":648},{"page":"home","views":757},{"page":"property","views":3561},{"page":"searchresults","views":1858}]},{"time":"2020-09-28T07:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":600},{"page":"home","views":752},{"page":"property","views":3117},{"page":"searchresults","views":1738}]},{"time":"2020-09-28T07:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":496},{"page":"home","views":734},{"page":"property","views":3063},{"page":"searchresults","views":1759}]},{"time":"2020-09-28T07:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":613},{"page":"home","views":703},{"page":"property","views":2904},{"page":"searchresults","views":1727}]},{"time":"2020-09-28T07:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":6},{"page":"bookingform","views":569},{"page":"home","views":718},{"page":"property","views":2774},{"page":"searchresults","views":1679}]},{"time":"2020-09-28T07:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":780},{"page":"home","views":858},{"page":"property","views":3279},{"page":"searchresults","views":1918}]},{"time":"2020-09-28T08:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":610},{"page":"home","views":740},{"page":"property","views":3035},{"page":"searchresults","views":1733}]},{"time":"2020-09-28T08:01:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":732},{"page":"home","views":873},{"page":"property","views":2839},{"page":"searchresults","views":1924}]},{"time":"2020-09-28T08:02:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":318},{"page":"home","views":776},{"page":"property","views":3056},{"page":"searchresults","views":1955}]},{"time":"2020-09-28T08:03:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":524},{"page":"home","views":784},{"page":"property","views":2973},{"page":"searchresults","views":1943}]},{"time":"2020-09-28T08:04:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":699},{"page":"home","views":759},{"page":"property","views":3119},{"page":"searchresults","views":2087}]},{"time":"2020-09-28T08:05:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":674},{"page":"home","views":702},{"page":"property","views":2912},{"page":"searchresults","views":1952}]},{"time":"2020-09-28T08:06:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":733},{"page":"home","views":845},{"page":"property","views":2983},{"page":"searchresults","views":1934}]},{"time":"2020-09-28T08:07:00Z","pageViewsData":[{"page":"bookingconfirmation","views":8},{"page":"bookingform","views":443},{"page":"home","views":797},{"page":"property","views":2933},{"page":"searchresults","views":1827}]},{"time":"2020-09-28T08:08:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":640},{"page":"home","views":824},{"page":"property","views":3095},{"page":"searchresults","views":1987}]},{"time":"2020-09-28T08:09:00Z","pageViewsData":[{"page":"bookingconfirmation","views":8},{"page":"bookingform","views":684},{"page":"home","views":811},{"page":"property","views":3309},{"page":"searchresults","views":2021}]},{"time":"2020-09-28T08:10:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":845},{"page":"home","views":782},{"page":"property","views":2840},{"page":"searchresults","views":1934}]},{"time":"2020-09-28T08:11:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":770},{"page":"home","views":795},{"page":"property","views":2937},{"page":"searchresults","views":1860}]},{"time":"2020-09-28T08:12:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":648},{"page":"home","views":871},{"page":"property","views":3029},{"page":"searchresults","views":1942}]},{"time":"2020-09-28T08:13:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":505},{"page":"home","views":798},{"page":"property","views":2988},{"page":"searchresults","views":1957}]},{"time":"2020-09-28T08:14:00Z","pageViewsData":[{"page":"bookingconfirmation","views":18},{"page":"bookingform","views":723},{"page":"home","views":940},{"page":"property","views":3331},{"page":"searchresults","views":2053}]},{"time":"2020-09-28T08:15:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":543},{"page":"home","views":692},{"page":"property","views":3109},{"page":"searchresults","views":1850}]},{"time":"2020-09-28T08:16:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":372},{"page":"home","views":750},{"page":"property","views":3319},{"page":"searchresults","views":1992}]},{"time":"2020-09-28T08:17:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":221},{"page":"home","views":849},{"page":"property","views":3310},{"page":"searchresults","views":1980}]},{"time":"2020-09-28T08:18:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":217},{"page":"home","views":815},{"page":"property","views":3219},{"page":"searchresults","views":2108}]},{"time":"2020-09-28T08:19:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":199},{"page":"home","views":838},{"page":"property","views":3163},{"page":"searchresults","views":2287}]},{"time":"2020-09-28T08:20:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":146},{"page":"home","views":734},{"page":"property","views":2883},{"page":"searchresults","views":2136}]},{"time":"2020-09-28T08:21:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":154},{"page":"home","views":767},{"page":"property","views":2771},{"page":"searchresults","views":2079}]},{"time":"2020-09-28T08:22:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":155},{"page":"home","views":930},{"page":"property","views":2849},{"page":"searchresults","views":2020}]},{"time":"2020-09-28T08:23:00Z","pageViewsData":[{"page":"bookingconfirmation","views":5},{"page":"bookingform","views":152},{"page":"home","views":759},{"page":"property","views":3021},{"page":"searchresults","views":2025}]},{"time":"2020-09-28T08:24:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":208},{"page":"home","views":761},{"page":"property","views":3164},{"page":"searchresults","views":2189}]},{"time":"2020-09-28T08:25:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":192},{"page":"home","views":757},{"page":"property","views":2972},{"page":"searchresults","views":2000}]},{"time":"2020-09-28T08:26:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":172},{"page":"home","views":832},{"page":"property","views":2760},{"page":"searchresults","views":1930}]},{"time":"2020-09-28T08:27:00Z","pageViewsData":[{"page":"bookingconfirmation","views":10},{"page":"bookingform","views":369},{"page":"home","views":762},{"page":"property","views":3105},{"page":"searchresults","views":1829}]},{"time":"2020-09-28T08:28:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":309},{"page":"home","views":800},{"page":"property","views":2693},{"page":"searchresults","views":1986}]},{"time":"2020-09-28T08:29:00Z","pageViewsData":[{"page":"bookingconfirmation","views":4},{"page":"bookingform","views":174},{"page":"home","views":846},{"page":"property","views":2886},{"page":"searchresults","views":2151}]},{"time":"2020-09-28T08:30:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":141},{"page":"home","views":758},{"page":"property","views":2656},{"page":"searchresults","views":1960}]},{"time":"2020-09-28T08:31:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":153},{"page":"home","views":837},{"page":"property","views":2594},{"page":"searchresults","views":1884}]},{"time":"2020-09-28T08:32:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":188},{"page":"home","views":825},{"page":"property","views":2646},{"page":"searchresults","views":1945}]},{"time":"2020-09-28T08:33:00Z","pageViewsData":[{"page":"bookingconfirmation","views":22},{"page":"bookingform","views":440},{"page":"home","views":788},{"page":"property","views":2729},{"page":"searchresults","views":1972}]},{"time":"2020-09-28T08:34:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":595},{"page":"home","views":717},{"page":"property","views":2806},{"page":"searchresults","views":2006}]},{"time":"2020-09-28T08:35:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":434},{"page":"home","views":787},{"page":"property","views":2756},{"page":"searchresults","views":1939}]},{"time":"2020-09-28T08:36:00Z","pageViewsData":[{"page":"bookingconfirmation","views":8},{"page":"bookingform","views":510},{"page":"home","views":905},{"page":"property","views":2483},{"page":"searchresults","views":1930}]},{"time":"2020-09-28T08:37:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":435},{"page":"home","views":835},{"page":"property","views":2779},{"page":"searchresults","views":1868}]},{"time":"2020-09-28T08:38:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":374},{"page":"home","views":765},{"page":"property","views":2762},{"page":"searchresults","views":1748}]},{"time":"2020-09-28T08:39:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":356},{"page":"home","views":964},{"page":"property","views":2854},{"page":"searchresults","views":2074}]},{"time":"2020-09-28T08:40:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":473},{"page":"home","views":850},{"page":"property","views":2635},{"page":"searchresults","views":1957}]},{"time":"2020-09-28T08:41:00Z","pageViewsData":[{"page":"bookingconfirmation","views":13},{"page":"bookingform","views":347},{"page":"home","views":839},{"page":"property","views":2632},{"page":"searchresults","views":1953}]},{"time":"2020-09-28T08:42:00Z","pageViewsData":[{"page":"bookingconfirmation","views":21},{"page":"bookingform","views":403},{"page":"home","views":905},{"page":"property","views":2728},{"page":"searchresults","views":1943}]},{"time":"2020-09-28T08:43:00Z","pageViewsData":[{"page":"bookingconfirmation","views":9},{"page":"bookingform","views":362},{"page":"home","views":886},{"page":"property","views":2696},{"page":"searchresults","views":1896}]},{"time":"2020-09-28T08:44:00Z","pageViewsData":[{"page":"bookingconfirmation","views":12},{"page":"bookingform","views":538},{"page":"home","views":864},{"page":"property","views":2998},{"page":"searchresults","views":2040}]},{"time":"2020-09-28T08:45:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":369},{"page":"home","views":815},{"page":"property","views":2787},{"page":"searchresults","views":1787}]},{"time":"2020-09-28T08:46:00Z","pageViewsData":[{"page":"bookingconfirmation","views":14},{"page":"bookingform","views":426},{"page":"home","views":869},{"page":"property","views":2825},{"page":"searchresults","views":1888}]},{"time":"2020-09-28T08:47:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":608},{"page":"home","views":835},{"page":"property","views":2732},{"page":"searchresults","views":1976}]},{"time":"2020-09-28T08:48:00Z","pageViewsData":[{"page":"bookingconfirmation","views":19},{"page":"bookingform","views":739},{"page":"home","views":835},{"page":"property","views":2987},{"page":"searchresults","views":2003}]},{"time":"2020-09-28T08:49:00Z","pageViewsData":[{"page":"bookingconfirmation","views":11},{"page":"bookingform","views":523},{"page":"home","views":912},{"page":"property","views":3184},{"page":"searchresults","views":1996}]},{"time":"2020-09-28T08:50:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":424},{"page":"home","views":782},{"page":"property","views":2949},{"page":"searchresults","views":1752}]},{"time":"2020-09-28T08:51:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":414},{"page":"home","views":924},{"page":"property","views":2981},{"page":"searchresults","views":1900}]},{"time":"2020-09-28T08:52:00Z","pageViewsData":[{"page":"bookingconfirmation","views":7},{"page":"bookingform","views":820},{"page":"home","views":755},{"page":"property","views":3314},{"page":"searchresults","views":1882}]},{"time":"2020-09-28T08:53:00Z","pageViewsData":[{"page":"bookingconfirmation","views":20},{"page":"bookingform","views":973},{"page":"home","views":787},{"page":"property","views":3110},{"page":"searchresults","views":1988}]},{"time":"2020-09-28T08:54:00Z","pageViewsData":[{"page":"bookingconfirmation","views":17},{"page":"bookingform","views":642},{"page":"home","views":841},{"page":"property","views":3285},{"page":"searchresults","views":1804}]},{"time":"2020-09-28T08:55:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":646},{"page":"home","views":725},{"page":"property","views":3354},{"page":"searchresults","views":1834}]},{"time":"2020-09-28T08:56:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":568},{"page":"home","views":858},{"page":"property","views":3115},{"page":"searchresults","views":1823}]},{"time":"2020-09-28T08:57:00Z","pageViewsData":[{"page":"bookingconfirmation","views":23},{"page":"bookingform","views":857},{"page":"home","views":806},{"page":"property","views":3121},{"page":"searchresults","views":1811}]},{"time":"2020-09-28T08:58:00Z","pageViewsData":[{"page":"bookingconfirmation","views":15},{"page":"bookingform","views":771},{"page":"home","views":851},{"page":"property","views":3155},{"page":"searchresults","views":1726}]},{"time":"2020-09-28T08:59:00Z","pageViewsData":[{"page":"bookingconfirmation","views":9},{"page":"bookingform","views":746},{"page":"home","views":902},{"page":"property","views":3394},{"page":"searchresults","views":1922}]},{"time":"2020-09-28T09:00:00Z","pageViewsData":[{"page":"bookingconfirmation","views":16},{"page":"bookingform","views":715},{"page":"home","views":744},{"page":"property","views":3117},{"page":"searchresults","views":1706}]}];

    const fetchPageViewsData = ([selectedBrand]) => {
        const {label: pageBrand, funnelBrand} = getBrand(selectedBrand, 'label');
        setIsLoading(true);
        setError('');
        const dateQuery = start && end
            ? `&startDate=${moment(start).utc().format()}&endDate=${moment(end).utc().format()}`
            : '';
        // fetch(`/v1/pageViews?brand=${funnelBrand}&timeInterval=1${dateQuery}`)
        //     .then(checkResponse)
        //     .then((fetchedPageviews) => {
        //         if (!fetchedPageviews || !fetchedPageviews.length) {
        //             setError('No data found. Try refreshing the page or select another brand.');
        //             return;
        //         }
                const widgetObjects = PAGES_LIST.map(({name, label}) => {
                    const aggregatedData = [];
                    fetchedPageviews.forEach(({time, pageViewsData}) => {
                        const currentPageViews = pageViewsData.find((item) => item.page === name);
                        if (currentPageViews) {
                            const momentTime = moment(time);
                            if (momentTime.isBetween(start, end, 'minutes', '[]')) {
                                aggregatedData.push({
                                    label: `${momentTime.format(PAGE_VIEWS_DATE_FORMAT)} ${TIMEZONE_ABBR}`,
                                    time: momentTime.format(PAGE_VIEWS_DATE_FORMAT),
                                    momentTime,
                                    value: currentPageViews.views
                                });
                            }
                        }
                    });
                    return {pageName: label, aggregatedData, pageBrand};
                });
                setWidgets(widgetObjects);
            // })
            // .catch((err) => {
            //     let errorMessage = (err.message && err.message.includes('query-timeout limit exceeded'))
            //         ? 'Query has timed out. Try refreshing the page. If the problem persists, please message #dpi-reo-opex-all or fill out our Feedback form.'
            //         : 'An unexpected error has occurred. Try refreshing the page. If this problem persists, please message #dpi-reo-opex-all or fill out our Feedback form.';
            //     setError(errorMessage);
            //     // eslint-disable-next-line no-console
            //     console.error(err);
            // })
            // .finally(() => setIsLoading(false));

        setIsLoading(false);
    };

    useEffect(() => {
        if ([EG_BRAND, EGENCIA_BRAND, EXPEDIA_PARTNER_SERVICES_BRAND].includes(selectedBrands[0])) {
            setError(`Page views for ${selectedBrands} is not yet available.
                The following brands are supported at this time: "Expedia", "Hotels.com Retail", and "Vrbo Retail".
                If you have any questions, please ping #dpi-reo-opex-all or leave a comment via our Feedback form.`);
            setIsFormDisabled(true);
        } else {
            setError(null);
            setIsFormDisabled(false);
            fetchPageViewsData(selectedBrands);
        }
    }, [selectedBrands, start, end]);

    useEffect(() => {
        const fetchAnnotations = () => {
            setDeploymentAnnotations([]);
            const dateQuery = start && end
                ? `&startDate=${moment(start).utc().format()}&endDate=${moment(end).utc().format()}`
                : '';

            fetch(`/annotations?${dateQuery}`)
                .then(checkResponse)
                .then((fetchedAnnotations) => {
                    const adjustedAnnotations = fetchedAnnotations.map((annotation) => ({
                        ...annotation,
                        tags: [annotation.productName, annotation.platform],
                        time: moment(annotation.openedAt).format(PAGE_VIEWS_DATE_FORMAT),
                        bucketTime: moment(annotation.openedAt).format(PAGE_VIEWS_DATE_FORMAT),
                        category: 'deployment'
                    }));

                    setDeploymentAnnotations(adjustedAnnotations);
                })
                .catch((err) => {
                    // eslint-disable-next-line no-console
                    console.error(err);
                });
        };

        fetchAnnotations();
    }, [start, end]);

    const filterAnnotations = (deployments, incidents) => {
        const filteredDeployments = deployments
            .filter(getAnnotationsFilter(selectedProducts, 'productName'))
            .filter(getAnnotationsFilter(selectedApplications, 'serviceName', true))
            .filter(getAnnotationsFilter(selectedServiceTiers, 'serviceTier'));

        const filteredIncidents = incidents
            .filter(getAnnotationsFilter(selectedStatuses, 'status'))
            .filter(getAnnotationsFilter(selectedPriorities, 'priority'));

        return [...filteredDeployments, ...filteredIncidents];
    };

    useEffect(() => {
        const deployments = deploymentCategory ? [...deploymentAnnotations] : [];
        const incidents = incidentCategory ? [...incidentAnnotations] : [];

        setFilteredAnnotations(filterAnnotations(deployments, incidents));
    }, [
        selectedProducts,
        selectedApplications,
        selectedServiceTiers,
        selectedStatuses,
        selectedPriorities
    ]);

    const filterCategories = (annotationsToFilter) => {
        const categoryOptions = [];

        if (deploymentCategory) {
            categoryOptions.push('deployment');
        }

        if (incidentCategory) {
            categoryOptions.push('incident');
        }

        const filteredRawAnnotations = annotationsToFilter.filter(({category}) => categoryOptions.includes(category));
        setFilteredAnnotations(filteredRawAnnotations);
    };

    const filterSuggestions = () => {
        let filteredRawSuggestions = {...suggestions};

        if (deploymentCategory) {
            addSuggestionType(filteredRawSuggestions, 'productName', productNameSuggestions);
            addSuggestionType(filteredRawSuggestions, 'serviceTier', serviceTierSuggestions);
            addSuggestionType(filteredRawSuggestions, 'applicationName', applicationNameSuggestions);
        } else {
            delete filteredRawSuggestions.applicationName;
            delete filteredRawSuggestions.productName;
            delete filteredRawSuggestions.serviceTier;
        }

        if (incidentCategory) {
            addSuggestionType(filteredRawSuggestions, 'incidentPriority', incidentPrioritySuggestions);
            addSuggestionType(filteredRawSuggestions, 'incidentStatus', incidentStatusSuggestions);
        } else {
            delete filteredRawSuggestions.incidentPriority;
            delete filteredRawSuggestions.incidentStatus;
        }

        setSuggestions(filteredRawSuggestions);
    };

    useEffect(() => {
        filterCategories(filterAnnotations(deploymentAnnotations, incidentAnnotations));
        filterSuggestions();
    }, [deploymentCategory, incidentCategory]);

    useEffect(() => {
        const fetchIncidents = () => {
            setIncidentAnnotations([]);
            const dateQuery = start && end
                ? `?fromDate=${moment(start).utc().format()}&toDate=${moment(end).utc().format()}`
                : '';

            fetch(`/v2/incidents${dateQuery}`)
                .then(checkResponse)
                .then((data) => {
                    const uniqueTickets = getUniqueByProperty(data, 'id');
                    const adjustedUniqueTickets = adjustTicketProperties(uniqueTickets, 'incident')
                        .map((incident) => {
                            incident.bucketTime = moment(incident.openDate).format(PAGE_VIEWS_DATE_FORMAT);
                            incident.time = moment(incident.openDate).format(PAGE_VIEWS_DATE_FORMAT);
                            incident.category = 'incident';

                            return incident;
                        });

                    const incidentPriority = getListOfUniqueProperties(adjustedUniqueTickets, 'priority').sort();
                    const incidentStatus = getListOfUniqueProperties(adjustedUniqueTickets, 'status').sort();

                    setIncidentPrioritySuggestions(incidentPriority);
                    setIncidentStatusSuggestions(incidentStatus);
                    setIncidentAnnotations(adjustedUniqueTickets);
                    setSuggestions((prevSuggestions) => ({
                        ...prevSuggestions,
                        incidentPriority,
                        incidentStatus
                    }));
                })
                .catch((err) => {
                    // eslint-disable-next-line no-console
                    console.error(err);
                });
        };

        fetchIncidents();
    }, [start, end]);

    useEffect(() => {
        const allAnnotations = [...deploymentAnnotations, ...incidentAnnotations];
        filterCategories(allAnnotations);
        filterSuggestions();
    }, [deploymentAnnotations, incidentAnnotations]);

    const handleDatetimeChange = ({start: startDateTimeStr, end: endDateTimeStr}, text) => {
        setPendingTimeRange(text || pendingTimeRange);
        setPendingStart(moment(startDateTimeStr));
        setPendingEnd(moment(endDateTimeStr));
        setIsDirtyForm(true);
    };

    const handleApplyFilters = () => {
        setCurrentTimeRange(pendingTimeRange);
        setStart(pendingStart);
        setEnd(pendingEnd);
        setIsDirtyForm(false);
    };

    const getWidgetXAxisTickGap = (timeRange) => [
        'Last 1 hour',
        'Last 3 hours',
        'Last 6 hours',
        'Last 12 hours',
        'Last 24 hours'
    ].includes(timeRange) ? 20 : 5;

    const renderWidget = ({pageName, aggregatedData, pageBrand}) => (
        <TravelerMetricsWidget
            title={pageName}
            data={aggregatedData}
            key={pageName}
            brand={pageBrand}
            tickGap={getWidgetXAxisTickGap(currentTimeRange)}
            onMouseDown={handleMouseDown}
            onMouseMove={handleMouseMove}
            onMouseUp={handleMouseUp}
            chartLeft={chartLeft}
            chartRight={chartRight}
            refAreaLeft={refAreaLeft}
            refAreaRight={refAreaRight}
            annotations={enableAnnotations ? filteredAnnotations : []}
        />
    );

    const onFilterChange = (value) => {
        const adjustedInputValue = adjustInputValue(value);

        setSelectedProducts(filterNewSelectedItems(adjustedInputValue, 'productName'));
        setSelectedApplications(filterNewSelectedItems(adjustedInputValue, 'applicationName'));
        setSelectedServiceTiers(filterNewSelectedItems(adjustedInputValue, 'serviceTier'));
        setSelectedStatuses(filterNewSelectedItems(adjustedInputValue, 'incidentStatus'));
        setSelectedPriorities(filterNewSelectedItems(adjustedInputValue, 'incidentPriority'));
    };

    useEffect(() => {
        const adjustedProducts = productMapping.map(({productName}) => productName);

        const adjustedApplications = productMapping.reduce((acc, current) => {
            return [...acc, ...current.applicationNames];
        }, []);
        const serviceTier = ['Tier 1', 'Tier 2', 'Tier 3'];

        setProductNameSuggestions(adjustedProducts);
        setApplicationNameSuggestions(adjustedApplications);
        setServiceTierSuggestions(serviceTier);

        setSuggestions((prevSuggestions) => ({
            ...prevSuggestions,
            productName: adjustedProducts,
            applicationName: adjustedApplications,
            serviceTier
        }));
    }, [productMapping]);

    return (
        <div className="funnel-views-container">
            <h1>{'Traveler Page Views'}</h1>
            <div className="filters-wrapper">
                <div className="date-filters-wrapper">
                    <DatetimeRangePicker
                        onChange={handleDatetimeChange}
                        startDate={pendingStart.toDate()}
                        endDate={pendingEnd.toDate()}
                        presets={getPresets()}
                        disabled={isFormDisabled}
                    />
                    <button
                        className="btn btn-primary apply-btn"
                        type="button"
                        onClick={handleApplyFilters}
                        disabled={!isDirtyForm}
                    >
                        {'Apply'}
                    </button>
                    <Checkbox
                        name="annotations-сheckbox"
                        label="Show Annotations"
                        checked={enableAnnotations}
                        onChange={() => setEnableAnnotations(!enableAnnotations)}
                        size="sm"
                        className="annotations-сheckbox"
                    />
                </div>
                {!isLoading && <>
                    <div className="annotation-filters-wrapper">
                        <div className="category-filters">
                            <Checkbox
                                name="deployment-сheckbox"
                                label="deployments"
                                checked={deploymentCategory}
                                onChange={() => setDeploymentCategory(!deploymentCategory)}
                                size="sm"
                            />
                            <Checkbox
                                name="incident-сheckbox"
                                label="incidents"
                                checked={incidentCategory}
                                onChange={() => setIncidentCategory(!incidentCategory)}
                                size="sm"
                            />
                        </div>
                        <UniversalSearch
                            suggestions={suggestions}
                            suggestionMapping={productMapping}
                            onFilterChange={onFilterChange}
                        />
                    </div>
                </>}
            </div>
            <LoadingContainer isLoading={isLoading} error={error} className="page-views-loading-container">
                <div className="page-views-widget-container">
                    {widgets.map(renderWidget)}
                </div>
            </LoadingContainer>
        </div>
    );
};

export default FunnelView;
